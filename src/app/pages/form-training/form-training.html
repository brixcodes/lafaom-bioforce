<div class="content">
    <div class="container-1440">
        <div class="page-header">
            <div class="has-background container-full"
                style="background-image: url('https://theangarabucket.s3.eu-north-1.amazonaws.com/public/job-applications/20251012_064544_actualite_s3.jpg')">
                <img src="https://theangarabucket.s3.eu-north-1.amazonaws.com/public/job-applications/20251012_064544_actualite_s3.jpg"
                    alt="">
            </div>
            <div class="page-header-inner">
                <div class="page-title">
                    <h1 style="text-transform: uppercase;">
                        Candidater à la formation.
                    </h1>
                </div>
                <div class="page-sub-title">
                    <div>
                        <span class="has-border-l-t d-block"></span>
                    </div>
                    <div>
                        <p>
                            Consultez tous les détails de cette formation et postulez directement.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-1440">
        <form [formGroup]="form" (ngSubmit)="submit()" novalidate>
            <div class="row container">
                <div class="col-lg-11 mx-auto">
                    <div class="application-card container-1440">
                        <h2 class="title-h2">Informations personnelles</h2>
                        <br>
                        <br>
                        <div class="row mt-4">
                            <div class="col-12 col-md-6 mb-3">
                                <label class="ml-2">Email <span class="text-danger">*</span></label>
                                <input type="email" class="form-control" formControlName="email">
                                <div class="text-danger mt-4 ml-3"
                                    *ngIf="form.get('email')?.touched && form.get('email')?.invalid">Email invalide
                                </div>
                            </div>
                            <div class="col-12 col-md-6 mb-3">
                                <label class="ml-2">Téléphone <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" formControlName="phone_number">
                                <div class="text-danger mt-4 ml-3"
                                    *ngIf="form.get('phone_number')?.touched && form.get('phone_number')?.invalid">Champ obligatoire
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12 col-md-6 mb-3">
                                <label class="ml-2">Prénom <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" formControlName="first_name">
                                <div class="text-danger mt-4 ml-3"
                                    *ngIf="form.get('first_name')?.touched && form.get('first_name')?.invalid">Champ obligatoire
                                </div>
                            </div>
                            <div class="col-12 col-md-6 mb-3">
                                <label class="ml-2">Nom <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" formControlName="last_name">
                                <div class="text-danger mt-4 ml-3"
                                    *ngIf="form.get('last_name')?.touched && form.get('last_name')?.invalid">Champ obligatoire
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12 col-md-6 mb-3">
                                <label class="ml-2">Code pays <span class="text-danger">*</span></label>
                                <select class="form-control" formControlName="country_code">
                                    <option value="SN">Sénégal</option>
                                    <option value="CI">Côte d'Ivoire</option>
                                    <option value="ML">Mali</option>
                                    <option value="BF">Burkina Faso</option>
                                    <option value="NE">Niger</option>
                                </select>
                                <div class="text-danger mt-4 ml-3"
                                    *ngIf="form.get('country_code')?.touched && form.get('country_code')?.invalid">Champ obligatoire
                                </div>
                            </div>
                            <div class="col-12 col-md-6 mb-3">
                                <label class="ml-2">Session de formation <span class="text-danger">*</span></label>
                                <select class="form-control" formControlName="target_session_id" 
                                    (change)="onSessionChange($event)">
                                    <option value="">Sélectionner une session</option>
                                    <option *ngFor="let session of sessions" [value]="session.id">
                                        {{ formatSessionDate(session.start_date) }} - {{ formatSessionDate(session.end_date) }}
                                        ({{ session.status === 'OPEN_FOR_REGISTRATION' ? 'Ouverte' : 'Fermée' }})
                                    </option>
                                </select>
                                <div class="text-danger mt-4 ml-3"
                                    *ngIf="form.get('target_session_id')?.touched && form.get('target_session_id')?.invalid">
                                    Veuillez sélectionner une session
                                </div>
                            </div>
                        </div>
                        
                        <!-- Section Méthode de paiement -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <h3 class="title-h3">Méthode de paiement</h3>
                                <p class="text-muted">Choisissez votre méthode de paiement préférée</p>
                                
                                <div class="row" *ngIf="!isLoadingPaymentMethods">
                                    <div class="col-12 col-md-6 mb-3" *ngFor="let method of paymentMethods">
                                        <div class="form-check">
                                            <input 
                                                class="form-check-input" 
                                                type="radio" 
                                                [id]="'payment_' + method.value"
                                                [value]="method.value"
                                                formControlName="payment_method"
                                                (change)="onPaymentMethodChange(method.value)"
                                                [checked]="selectedPaymentMethod === method.value">
                                            <label class="form-check-label" [for]="'payment_' + method.value">
                                                <strong>{{ method.label }}</strong>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-center" *ngIf="isLoadingPaymentMethods">
                                    <div class="spinner-border" role="status">
                                        <span class="sr-only">Chargement...</span>
                                    </div>
                                    <p class="mt-2">Chargement des méthodes de paiement...</p>
                                </div>
                                
                                <div class="text-danger mt-2"
                                    *ngIf="form.get('payment_method')?.touched && form.get('payment_method')?.invalid">
                                    Veuillez sélectionner une méthode de paiement
                                </div>
                            </div>
                        </div>
                        
                        <br>
                        <div class="form-check my-3">
                            <input class="form-check-input" type="checkbox" id="consent" formControlName="consent">
                            <label class="form-check-label ml-2" for="consent">
                                J'accepte le traitement de mes données personnelles pour cette candidature.
                            </label>
                            <div class="text-danger"
                                *ngIf="form.get('consent')?.touched && form.get('consent')?.invalid">Consentement requis
                            </div>
                        </div>
                        <br>
                        <div class="alert alert-danger" *ngIf="submitError">{{ submitError }}</div>
                        <div class="d-flex justify-content-end">
                            <button class="btn btn-primary" type="submit" [disabled]="isSubmitting">{{ isSubmitting ?
                                'Envoi...' : 'Soumettre la candidature' }}</button>
                        </div>
                        <br>
                        <br>
                    </div>
                </div>
            </div>
        </form>
    </div>


</div>