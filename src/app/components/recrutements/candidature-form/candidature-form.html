<div class="candidature-form">
  <div class="form-container">
    <h2 class="form-title">{{ 'recruitment.application.applicationFormTitle' | translate }}</h2>

    <!-- Indicateur de progression -->
    <div class="upload-progress" *ngIf="uploadingCount > 0 || uploadProgress > 0">
      <div class="progress-info">
        <span *ngIf="uploadingCount > 0">{{ 'recruitment.application.uploadProgress' | translate }} ({{uploadingCount}} fichier(s))</span>
        <span *ngIf="uploadingCount === 0 && uploadProgress > 0">{{ 'recruitment.application.progress' | translate }}: {{uploadProgress}}%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="uploadProgress"></div>
      </div>
    </div>

    <!-- Messages d'erreur -->
    <div class="error-alert" *ngIf="errors.length > 0">
      <ul>
        <li *ngFor="let error of errors">{{error}}</li>
      </ul>
    </div>

    <form (ngSubmit)="submitApplication()">
      <!-- Informations personnelles -->
      <div class="form-section">
        <h4>{{ 'recruitment.application.personalInfo' | translate }}</h4>
        <p class="section-description">{{ 'recruitment.application.fillPersonalInfo' | translate }}</p>
        
        <div class="form-row">
          <div class="form-group">
            <label for="civility">{{ 'recruitment.application.civility' | translate }} *</label>
            <select id="civility" [(ngModel)]="form.civility" name="civility" required
                    (change)="logChange('Civilit√©', $event)">
              <option value="">{{ 'recruitment.application.selectCivility' | translate }}</option>
              <option *ngFor="let option of civilityOptions" [value]="option.value">
                {{option.label}}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label for="date_of_birth">{{ 'recruitment.application.dateOfBirth' | translate }}</label>
            <input type="date" id="date_of_birth" [(ngModel)]="form.date_of_birth" name="date_of_birth"
                   (change)="logChange('Date de naissance', $event)">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="first_name">{{ 'recruitment.application.firstName' | translate }} *</label>
            <input type="text" id="first_name" [(ngModel)]="form.first_name" name="first_name" required
                   (change)="logChange('Pr√©nom', $event)">
          </div>
          <div class="form-group">
            <label for="last_name">{{ 'recruitment.application.lastName' | translate }} *</label>
            <input type="text" id="last_name" [(ngModel)]="form.last_name" name="last_name" required
                   (change)="logChange('Nom', $event)">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="email">{{ 'recruitment.application.email' | translate }} *</label>
            <input type="email" id="email" [(ngModel)]="form.email" name="email" required
                   (change)="logChange('Email', $event)">
          </div>
          <div class="form-group">
            <label for="phone_number">{{ 'recruitment.application.phoneNumber' | translate }} *</label>
            <input type="tel" id="phone_number" [(ngModel)]="form.phone_number" name="phone_number" required
                   (change)="logChange('T√©l√©phone', $event)">
          </div>
        </div>
      </div>

      <!-- Adresse -->
      <div class="form-section">
        <h4>{{ 'recruitment.application.address' | translate }}</h4>
        <p class="section-description">{{ 'recruitment.application.residenceAddress' | translate }}</p>
        
        <div class="form-row">
          <div class="form-group">
            <label for="city">{{ 'recruitment.application.city' | translate }} *</label>
            <input type="text" id="city" [(ngModel)]="form.city" name="city" required>
          </div>
          <div class="form-group">
            <label for="country_code">{{ 'recruitment.application.country' | translate }}</label>
            <select id="country_code" [(ngModel)]="form.country_code" name="country_code">
              <option value="SN">S√©n√©gal</option>
              <option value="ML">Mali</option>
              <option value="BF">Burkina Faso</option>
              <option value="CI">C√¥te d'Ivoire</option>
              <option value="GN">Guin√©e</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="address">{{ 'recruitment.application.addressLabel' | translate }} *</label>
          <input type="text" id="address" [(ngModel)]="form.address" name="address" required>
        </div>
      </div>

      <!-- Documents requis -->
      <div class="form-section">
        <h4>{{ 'recruitment.application.requiredDocuments' | translate }}</h4>
        <p class="section-description">{{ 'recruitment.application.uploadDocumentsDescription' | translate }}</p>
        
        <div class="documents-grid">
          <!-- CV -->
          <div class="document-upload">
            <div class="document-header">
              <h5>CV *</h5>
              <span class="document-status" [ngClass]="getDocumentStatus('CV')">
                <span *ngIf="getDocumentStatus('CV') === 'pending'">{{ 'recruitment.application.pending' | translate }}</span>
                <span *ngIf="getDocumentStatus('CV') === 'uploading'">{{ 'recruitment.application.uploading' | translate }}</span>
                <span *ngIf="getDocumentStatus('CV') === 'completed'">‚úì {{ 'recruitment.application.completed' | translate }}</span>
                <span *ngIf="getDocumentStatus('CV') === 'error'">‚úó {{ 'recruitment.application.error' | translate }}</span>
              </span>
            </div>
            <div class="file-input-container">
              <input type="file" 
                     class="file-input" 
                     (change)="onFileSelected($event, 'CV')"
                     accept=".pdf,.doc,.docx">
              <label class="file-label">
                <span>üìÑ</span>
                <span>{{ 'recruitment.application.clickToSelectCV' | translate }}</span>
              </label>
            </div>
            <div class="file-info" *ngIf="getSelectedFile('CV')">
              {{ 'recruitment.application.fileSelected' | translate }}: {{getSelectedFile('CV')?.name}}
            </div>
          </div>

          <!-- Lettre de motivation -->
          <div class="document-upload">
            <div class="document-header">
              <h5>Lettre de motivation *</h5>
              <span class="document-status" [ngClass]="getDocumentStatus('COVER_LETTER')">
                <span *ngIf="getDocumentStatus('COVER_LETTER') === 'pending'">{{ 'recruitment.application.pending' | translate }}</span>
                <span *ngIf="getDocumentStatus('COVER_LETTER') === 'uploading'">{{ 'recruitment.application.uploading' | translate }}</span>
                <span *ngIf="getDocumentStatus('COVER_LETTER') === 'completed'">‚úì {{ 'recruitment.application.completed' | translate }}</span>
                <span *ngIf="getDocumentStatus('COVER_LETTER') === 'error'">‚úó {{ 'recruitment.application.error' | translate }}</span>
              </span>
            </div>
            <div class="file-input-container">
              <input type="file" 
                     class="file-input" 
                     (change)="onFileSelected($event, 'COVER_LETTER')"
                     accept=".pdf,.doc,.docx">
              <label class="file-label">
                <span>üìù</span>
                <span>{{ 'recruitment.application.clickToSelectLetter' | translate }}</span>
              </label>
            </div>
            <div class="file-info" *ngIf="getSelectedFile('COVER_LETTER')">
              {{ 'recruitment.application.fileSelected' | translate }}: {{getSelectedFile('COVER_LETTER')?.name}}
            </div>
          </div>

          <!-- Dipl√¥me -->
          <div class="document-upload">
            <div class="document-header">
              <h5>Dipl√¥me *</h5>
              <span class="document-status" [ngClass]="getDocumentStatus('DIPLOMA')">
                <span *ngIf="getDocumentStatus('DIPLOMA') === 'pending'">{{ 'recruitment.application.pending' | translate }}</span>
                <span *ngIf="getDocumentStatus('DIPLOMA') === 'uploading'">{{ 'recruitment.application.uploading' | translate }}</span>
                <span *ngIf="getDocumentStatus('DIPLOMA') === 'completed'">‚úì {{ 'recruitment.application.completed' | translate }}</span>
                <span *ngIf="getDocumentStatus('DIPLOMA') === 'error'">‚úó {{ 'recruitment.application.error' | translate }}</span>
              </span>
            </div>
            <div class="file-input-container">
              <input type="file" 
                     class="file-input" 
                     (change)="onFileSelected($event, 'DIPLOMA')"
                     accept=".pdf,.doc,.docx">
              <label class="file-label">
                <span>üéì</span>
                <span>{{ 'recruitment.application.clickToSelectDiploma' | translate }}</span>
              </label>
            </div>
            <div class="file-info" *ngIf="getSelectedFile('DIPLOMA')">
              {{ 'recruitment.application.fileSelected' | translate }}: {{getSelectedFile('DIPLOMA')?.name}}
            </div>
          </div>
        </div>
      </div>

      <!-- Boutons d'action -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="form = {
          first_name: '',
          last_name: '',
          email: '',
          phone_number: '',
          civility: '',
          city: '',
          address: '',
          date_of_birth: '',
          country_code: 'SN'
        }; attachments = []; errors = [];">
          {{ 'recruitment.application.reset' | translate }}
        </button>
        <button type="submit" 
                class="btn btn-primary" 
                [disabled]="!isFormValid() || isSubmitting"
                [ngClass]="{'loading': isSubmitting}">
          <span *ngIf="isSubmitting">{{ 'recruitment.application.submitting' | translate }}</span>
          <span *ngIf="!isSubmitting">{{ 'recruitment.application.submit' | translate }}</span>
        </button>
      </div>
    </form>
  </div>
</div>
